"use strict";!function(){$(document).ready(function(){function a(){this.weatherStations=[]}function b(a,b,c){this.stationId=a,this.stationName=b,this.windSpeed=0,this.windAngle=0,this.temperature="",this.timestamp="",this.mapTimestamp=this.getTimeStamp(-2),this.chartImageURL=e+this.stationId+f,this.DOMElement={},this.mapID=c}var c="http://servlet.dmi.dk/bv/servlet/",d=c+"bv?stat=",e=c+"bvImage?stat=",f="&param=wind",g="https://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20html%20where%20url%3D%22"+encodeURIComponent(d),h=$("#weather-app .weather-stations"),i=$("#weather-station-template").html(),j=$("#list-header-template").html();a.prototype={constructor:a,addWeatherStations:function(a,c){var d=this,e=a.stations;if("object"!=typeof e||e.length<1)throw new TypeError('addWeatherStations argument expected to be an Object (found "'+typeof e)+'"), and argument must contain at least one weather station (found "'+e.length+'")';c.length>0&&this.renderRegionLabel(c),$.each(e,function(a,c){var e=new b(c.id,c.name,c.mapID);e.renderWeatherStation(),d.weatherStations.push(e),setTimeout(function(){e.getDOMElement().addClass("animated fadeIn")},100*(d.weatherStations.length+1)),e.loadWeatherData()})},renderRegionLabel:function(a){var b,c={regionName:a};Mustache.parse(j),b=Mustache.render(j,c),h.append(b)},refreshAll:function(){console.log(this.weatherStations)}},b.prototype={constructor:b,whoAmI:function(){console.log("I am: "+this.stationName)},loadWeatherData:function(){var a,b,c=this;this.setState("loading"),a=g+this.stationId+"%22&format=xml&callback=?",$.jsonp({url:a,success:function(a){a.results[0]&&(b=c.filterData(a.results[0]),c.setWeatherData(b),c.fillWeatherData())},error:function(a,b){c.setState("error")}})},getDOMElement:function(){return this.DOMElement},filterData:function(a){var b,c,d,e,f,g,h,i,j,k,l,m;return a=a.replace(/<?\/body[^>]*>/g,""),a=a.replace(/[\r|\n]+/g,""),a=a.replace(/<--[\S\s]*?-->/g,""),a=a.replace(/<noscript[^>]*>[\S\s]*?<\/noscript>/g,""),a=a.replace(/<script[^>]*>[\S\s]*?<\/script>/g,""),a=a.replace(/<script.*\/>/,""),a=a.replace(/<img.*\/>/,""),b=".*?",c="((?:(?:[0-1][0-9])|(?:[2][0-3])|(?:[0-9])):(?:[0-5][0-9])(?::[0-5][0-9])?(?:\\s?(?:am|AM|pm|PM))?)",d=".*?",e="(\\d+)",f=".*?",g="([+-]?\\d*\\.\\d+)(?![-+0-9\\.])",h=new RegExp(b+c+d+e+f+g,["i"]),i=h.exec(a),null!=i?(j=i[1].replace(/</,"&lt;"),k=i[2].replace(/</,"&lt;"),l=i[3].replace(/</,"&lt;"),m={windSpeed:l,windAngle:k,timestamp:j}):void 0},setWeatherData:function(a){this.windSpeed=a.windSpeed,this.windAngle=a.windAngle,this.timestamp=a.timestamp},addZeroBefore:function(a){return(10>a?"0":"")+a},getTimeStamp:function(a){var b=new Date,c=b.getHours()-2,d=b.getFullYear(),e=this.addZeroBefore(b.getMonth()+1),f=this.addZeroBefore(b.getDate()),g=this.addZeroBefore(c),h=d+e+f+g+"0000";return h},fillWeatherData:function(){var a=this.DOMElement.find(".station-wind-direction"),b=this;this.DOMElement.find(".station-wind-speed b").html(this.windSpeed),this.DOMElement.find(".station-timestamp").html(this.timestamp),this.DOMElement.find(".station-timestamp").html(this.timestamp),this.DOMElement.find(".station-chart img").attr("src",this.chartImageURL),setTimeout(function(){b.setWindDirection(a,b.windAngle)},300),this.setState("done")},setWindDirection:function(a,b){$(a[0]).css("-moz-transform","rotate("+b+"deg)"),$(a[0]).css("-webkit-transform","rotate("+b+"deg)"),$(a[0]).css("-ms-transform","rotate("+b+"deg)"),$(a[0]).css("-o-transform","rotate("+b+"deg)"),$(a[0]).css("transform","rotate("+b+"deg)")},setState:function(a){this.DOMElement.attr("data-state",a)},renderWeatherStation:function(){var a;Mustache.parse(i),a=Mustache.render(i,this),h.append(a),this.DOMElement=h.find('[data-station-id="'+this.stationId+'"]')}};var k={stations:[{name:"Drogden",id:"6183",mapID:"OERESUND"},{name:"Kbh lufthavn",id:"6180",mapID:"OERESUND"},{name:"Lyngbyvej",id:"6184",mapID:"OERESUND"},{name:"Gniben",id:"6169",mapID:"KATTEGAT_SOUTH"},{name:"Jægerspris",id:"56",mapID:"SOUND_BELT"},{name:"Nakkehoved Fyr",id:"6168",mapID:"KATTEGAT_SOUTH"},{name:"Vindebæk Kyst",id:"6147",mapID:"SJAELLAND_SOUTH"},{name:"Røsnæs Fyr",id:"6159",mapID:"SOUND_BELT"}]},l={stations:[{name:"Langø",id:"6138",mapID:"SJAELLAND_SOUTH"},{name:"Gedser",id:"6149",mapID:"SJAELLAND_SOUTH"}]},m={stations:[{name:"Kraneled",id:"1350",mapID:"BELT"},{name:"Assens",id:"6123",mapID:"BELT"},{name:"Sydfyns Flyveplads",id:"6124",mapID:"BELT"},{name:"Klintholm",id:"871",mapID:"BELT"}]},n={stations:[{name:"Frederikshavn",id:"6042",mapID:"SKAGERRAK"},{name:"Hirtshals",id:"6033",mapID:"SKAGERRAK"},{name:"Hanstholm",id:"6021",mapID:"SKAGERRAK"},{name:"Skagen Fyr",id:"6041",mapID:"SKAGERRAK"}]},o={stations:[{name:"Hvide Sande",id:"6058",mapID:"BELT"},{name:"Thyborøn",id:"6052",mapID:"FISKER"},{name:"Torsminde",id:"6055",mapID:"FISKER"},{name:"Sletterhage Fyr",id:"6073",mapID:"KATTEGAT_SOUTH"}]},p={stations:[{name:"Rømø",id:"6096",mapID:"TYSKE"},{name:"Højer",id:"653",mapID:"TYSKE"},{name:"Blåvandshug Fyr",id:"6081",mapID:"TYSKE"},{name:"Vester Vedsted",id:"6093",mapID:"TYSKE"}]},q={stations:[{name:"Omø Fyr",id:"6151",mapID:"SJAELLAND_SOUTH"},{name:"Anholt",id:"6079",mapID:"KATTEGAT"}]},r=new a;r.addWeatherStations(k,"Sjælland"),r.addWeatherStations(l,"Lolland Falster"),r.addWeatherStations(m,"Fyn"),r.addWeatherStations(n,"Nordjylland"),r.addWeatherStations(o,"Midtjylland"),r.addWeatherStations(p,"Sønderjylland"),r.addWeatherStations(q,"Øerne")})}();