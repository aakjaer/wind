"use strict";!function(){$(document).ready(function(){function a(){this.weatherStations=[]}function b(a,b){this.stationId=a,this.stationName=b,this.windSpeed=0,this.windAngle=0,this.temperature="",this.timestamp="",this.chartImageURL=e+this.stationId+f,this.DOMElement={}}var c="http://servlet.dmi.dk/bv/servlet/",d=c+"bv?stat=",e=c+"bvImage?stat=",f="&param=wind",g="https://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20html%20where%20url%3D%22"+encodeURIComponent(d),h=$("#weather-app .weather-stations"),i=$("#weather-station-template").html(),j=$("#list-header-template").html();a.prototype={constructor:a,addWeatherStations:function(a,c){var d=this;if("object"!=typeof a||a.length<1)throw new TypeError('addWeatherStations argument expected to be an Object (found "'+typeof a)+'"), and argument must contain at least one weather station (found "'+a.length+'")';c.length>0&&this.renderRegionLabel(c),$.each(a,function(a,c){var e=new b(c.id,c.name);e.renderWeatherStation(),d.weatherStations.push(e),setTimeout(function(){e.getDOMElement().addClass("animated fadeIn")},100*(d.weatherStations.length+1)),e.loadWeatherData()})},renderRegionLabel:function(a){var b,c={regionName:a};Mustache.parse(j),b=Mustache.render(j,c),h.append(b)},refreshAll:function(){console.log(this.weatherStations)}},b.prototype={constructor:b,whoAmI:function(){console.log("I am: "+this.stationName)},loadWeatherData:function(){var a,b,c=this;this.setState("loading"),a=g+this.stationId+"%22&format=xml&callback=?",$.jsonp({url:a,success:function(a){a.results[0]&&(b=c.filterData(a.results[0]),c.setWeatherData(b),c.fillWeatherData())},error:function(){c.setState("error")}})},getDOMElement:function(){return this.DOMElement},filterData:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;return a=a.replace(/<?\/body[^>]*>/g,""),a=a.replace(/[\r|\n]+/g,""),a=a.replace(/<--[\S\s]*?-->/g,""),a=a.replace(/<noscript[^>]*>[\S\s]*?<\/noscript>/g,""),a=a.replace(/<script[^>]*>[\S\s]*?<\/script>/g,""),a=a.replace(/<script.*\/>/,""),a=a.replace(/<img.*\/>/,""),b=".*?",c="((?:(?:[0-1][0-9])|(?:[2][0-3])|(?:[0-9])):(?:[0-5][0-9])(?::[0-5][0-9])?(?:\\s?(?:am|AM|pm|PM))?)",d=".*?",e="(\\d+)",f=".*?",g="([+-]?\\d*\\.\\d+)(?![-+0-9\\.])",h=".*?",i="([+-]?\\d*\\.\\d+)(?![-+0-9\\.])",j=new RegExp(b+c+d+e+f+g+h+i,["i"]),k=j.exec(a),null!==k?(l=k[1].replace(/</,"&lt;"),m=k[2].replace(/</,"&lt;"),n=k[3].replace(/</,"&lt;"),o=k[4].replace(/</,"&lt;"),p={windSpeed:n,windAngle:m,temperature:o,timestamp:l}):void 0},setWeatherData:function(a){this.windSpeed=a.windSpeed,this.windAngle=a.windAngle,this.temperature=a.temperature,this.timestamp=a.timestamp},fillWeatherData:function(){var a=this.DOMElement.find(".station-wind-direction"),b=this;this.DOMElement.find(".station-wind-speed b").html(this.windSpeed),this.DOMElement.find(".station-timestamp").html(this.timestamp),this.DOMElement.find(".station-timestamp").html(this.timestamp),this.DOMElement.find(".station-temperature").html(this.temperature),this.DOMElement.find(".station-chart img").attr("src",this.chartImageURL),setTimeout(function(){b.setWindDirection(a,b.windAngle)},300),this.setState("done")},setWindDirection:function(a,b){$(a[0]).css("-moz-transform","rotate("+b+"deg)"),$(a[0]).css("-webkit-transform","rotate("+b+"deg)"),$(a[0]).css("-ms-transform","rotate("+b+"deg)"),$(a[0]).css("-o-transform","rotate("+b+"deg)")},setState:function(a){this.DOMElement.attr("data-state",a)},renderWeatherStation:function(){var a;Mustache.parse(i),a=Mustache.render(i,this),h.append(a),this.DOMElement=h.find('[data-station-id="'+this.stationId+'"]')}};var k=[{name:"Drogden",id:"6183"},{name:"Kbh lufthavn",id:"6180"},{name:"Gniben",id:"6169"},{name:"Jægerspris",id:"56"},{name:"Nakkehoved Fyr",id:"6168"},{name:"Langø",id:"6138"}],l=[{name:"Kraneled",id:"1350"},{name:"Assens",id:"6123"},{name:"Vindebæk Kyst",id:"6147"}],m=[{name:"Hirtshals",id:"6033"},{name:"Thyborøn",id:"6052"},{name:"Torsminde",id:"6055"},{name:"Sletterhage Fyr",id:"6073"},{name:"Hvide Sande",id:"6058"},{name:"Rømø",id:"6096"}],n=new a;n.addWeatherStations(k,"Sjælland"),n.addWeatherStations(l,"Fyn"),n.addWeatherStations(m,"Jylland")})}();